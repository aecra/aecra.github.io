<!doctype html>



































<html
  class="not-ready lg:text-base"
  style="--bg: #faf8f1"
  lang="en"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Why shouldn&#39;t I use mysql_* functions in PHP? - Tian Jiale&#39;s Blog</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="PHP offers three different APIs to connect to MySQL. These are the mysql(removed as of PHP 7), mysqli, and PDO extensions.
The mysql_ functions used to be very popular, but their use is not encouraged anymore. The documentation team is discussing the database security situation, and educating users to move away from the commonly used ext/mysql extension is part of this (check php.internals: deprecating ext/mysql).
And the later PHP developer team has taken the decision to generate E_DEPRECATED errors when users connect to MySQL, whether through mysql_connect(), mysql_pconnect() or the implicit connection functionality built into ext/mysql." />
  <meta name="author" content="Tian Jiale" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://aecra.github.io/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="https://aecra.github.io/theme.png" />

  
  
  
  
  <link rel="preload" as="image" href="https://static.aecra.cn/avatar.png" />
  
  

  
  
  <link rel="preload" as="image" href="https://aecra.github.io/github.svg" />
  
  

  
  
  <script
    defer
    src="https://aecra.github.io/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css"
  integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI"
  crossorigin="anonymous"
/>
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js"
  integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t"
  crossorigin="anonymous"
></script>
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js"
  integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
  crossorigin="anonymous"
></script>

<script>
    document.addEventListener("DOMContentLoaded", () =>
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
          ],
          
          throwOnError : false
        })
    );
</script>

  
  
  

  
  <link rel="icon" href="https://aecra.github.io/favicon.ico" />
  <link rel="apple-touch-icon" href="https://aecra.github.io/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.121.1">

  
  
  
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V4ML7JFB21"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-V4ML7JFB21', { 'anonymize_ip': false });
}
</script>

  
  <meta itemprop="name" content="Why shouldn&#39;t I use mysql_* functions in PHP?">
<meta itemprop="description" content="This article is an answer from stackoverflow. A blog written a few years ago uses mysql_* technology in the background. However, during code refactoring this year, it was found that PDO can solve the mysql problem of anti-human and unsafe, so this article is excerpted for record."><meta itemprop="datePublished" content="2021-02-14T14:26:56+00:00" />
<meta itemprop="dateModified" content="2021-02-14T14:26:56+00:00" />
<meta itemprop="wordCount" content="2267">
<meta itemprop="keywords" content="PHP,PDO,MySQL," />
  
  <meta property="og:title" content="Why shouldn&#39;t I use mysql_* functions in PHP?" />
<meta property="og:description" content="This article is an answer from stackoverflow. A blog written a few years ago uses mysql_* technology in the background. However, during code refactoring this year, it was found that PDO can solve the mysql problem of anti-human and unsafe, so this article is excerpted for record." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://aecra.github.io/en/article/why-should-not-i-use-mysql-functions-in-php/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-02-14T14:26:56+00:00" />
<meta property="article:modified_time" content="2021-02-14T14:26:56+00:00" />


  
  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Why shouldn&#39;t I use mysql_* functions in PHP?"/>
<meta name="twitter:description" content="This article is an answer from stackoverflow. A blog written a few years ago uses mysql_* technology in the background. However, during code refactoring this year, it was found that PDO can solve the mysql problem of anti-human and unsafe, so this article is excerpted for record."/>

  
  
  
  <link rel="canonical" href="https://aecra.github.io/en/article/why-should-not-i-use-mysql-functions-in-php/" />
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="https://aecra.github.io"
      >Tian Jiale&#39;s Blog</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/aecra"
        target="_blank"
        rel="me"
      >
        github
      </a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Why shouldn&#39;t I use mysql_* functions in PHP?</h1>

    
    <div class="text-sm antialiased opacity-60">
      
      <time>Feb 14, 2021</time>
      
      
      
      
    </div>
    
  </header>

  <section><p>PHP offers three different APIs to connect to MySQL. These are the <a href="http://in1.php.net/manual/en/book.mysql.php">mysql</a>(removed as of PHP 7), <a href="http://uk.php.net/manual/en/book.mysqli.php">mysqli</a>, and <a href="http://php.net/manual/en/book.pdo.php">PDO</a> extensions.</p>
<p>The <strong>mysql_</strong> functions used to be very popular, but their use is not encouraged anymore. The documentation team is discussing the database security situation, and educating users to move away from the commonly used ext/mysql extension is part of this (check <em><a href="http://news.php.net/php.internals/53799">php.internals: deprecating ext/mysql</a></em>).</p>
<p>And the later PHP developer team has taken the decision to generate <a href="https://github.com/php/php-src/commit/b7091aaf0137d97cf4aa4a402ec50b3946d369c0"><strong>E_DEPRECATED</strong></a> errors when users connect to MySQL, whether through <strong>mysql_connect()</strong>, <strong>mysql_pconnect()</strong> or the implicit connection functionality built into <strong>ext/mysql</strong>.</p>
<p><strong>ext/mysql</strong> was <a href="https://wiki.php.net/rfc/mysql_deprecation"><strong>officially deprecated as of PHP 5.5</strong></a> and has been <a href="https://wiki.php.net/rfc/remove_deprecated_functionality_in_php7"><strong>removed as of PHP 7</strong></a>.</p>
<p><strong>See the Red Box?</strong></p>
<p>When you go on any <strong>mysql_</strong> function manual page, you see a red box, explaining it should not be used anymore.</p>
<h2 id="what-is-the-shortcomings-of-mysql_">What is the shortcomings of mysql_*?</h2>
<p>Moving away from <strong>ext/mysql</strong> is not only about security, but also about having access to all the features of the MySQL database.</p>
<p><strong>ext/mysql</strong> was built for <strong>MySQL 3.23</strong> and only got very few additions since then while mostly keeping compatibility with this old version which makes the code a bit harder to maintain. Missing features that is not supported by <strong>ext/mysql</strong> include: (<em><a href="https://wiki.php.net/rfc/mysql_deprecation">from PHP manual</a></em>).</p>
<ul>
<li><a href="http://en.wikipedia.org/wiki/Stored_procedure">Stored procedures</a> (can&rsquo;t handle multiple result sets)</li>
<li><a href="http://en.wikipedia.org/wiki/Prepared_statement">Prepared statements</a></li>
<li>Encryption (SSL)</li>
<li>Compression</li>
<li>Full Charset support</li>
</ul>
<p>Reason to not use <strong>mysql_*</strong> function:</p>
<ul>
<li>Not under active development</li>
<li>Removed as of PHP 7</li>
<li>Lacks an OO interface</li>
<li>Doesn&rsquo;t support non-blocking, asynchronous queries</li>
<li>Doesn&rsquo;t support prepared statements or <a href="http://en.wikipedia.org/wiki/Prepared_statement">parameterized queries</a></li>
<li>Doesn&rsquo;t support stored procedures</li>
<li>Doesn&rsquo;t support multiple statements</li>
<li>Doesn&rsquo;t support <a href="http://en.wikipedia.org/wiki/Database_transaction">transactions</a></li>
<li>Doesn&rsquo;t support all of the functionality in MySQL 5.1</li>
</ul>
<p><a href="https://stackoverflow.com/a/12860046/1723893">Above point quoted from Quentin&rsquo;s answer</a></p>
<p>Lack of support for prepared statements is particularly important as they provide a clearer, less error prone method of escaping and quoting external data than manually escaping it with a separate function call.</p>
<p>See the <a href="http://php.net/manual/en/mysqlinfo.api.choosing.php">comparison of SQL extensions</a>.</p>
<h2 id="contrast-use-of-mysql_-and-pdo">Contrast use of mysql_* and PDO</h2>
<h3 id="q-first-question-in-my-mind-was-what-is-pdo">Q. First question in my mind was: what is PDO?</h3>
<p>A. “<strong>PDO – PHP Data Objects</strong> – is a database access layer providing a uniform method of access to multiple databases.”</p>
<h3 id="connecting-to-mysql">Connecting to MySQL</h3>
<p>With <strong>mysql_</strong> function or we can say it the old way (deprecated in PHP 5.5 and above)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$link <span style="color:#f92672">=</span> <span style="color:#a6e22e">mysql_connect</span>(<span style="color:#e6db74">&#39;localhost&#39;</span>, <span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#e6db74">&#39;pass&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mysql_select_db</span>(<span style="color:#e6db74">&#39;testdb&#39;</span>, $link);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mysql_set_charset</span>(<span style="color:#e6db74">&#39;UTF-8&#39;</span>, $link);
</span></span></code></pre></div><p>With <strong>PDO</strong>: All you need to do is create a new <strong>PDO</strong> object. The constructor accepts parameters for specifying the database source <strong>PDO</strong>&rsquo;s constructor mostly takes four parameters which are <strong>DSN</strong> (data source name) and optionally <strong>username</strong>, <strong>password</strong>.</p>
<p>Here I think you are familiar with all except <strong>DSN</strong>; this is new in <strong>PDO</strong>. A <strong>DSN</strong> is basically a string of options that tell <strong>PDO</strong> which driver to use, and connection details. For further reference, check <a href="http://www.php.net/manual/en/ref.pdo-mysql.connection.php">PDO MySQL DSN</a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$db <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PDO</span>(<span style="color:#e6db74">&#39;mysql:host=localhost;dbname=testdb;charset=utf8&#39;</span>, <span style="color:#e6db74">&#39;username&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>);
</span></span></code></pre></div><p><strong>Note:</strong> you can also use <strong>charset=UTF-8</strong>, but sometimes it causes an error, so it&rsquo;s better to use <strong>utf8</strong>.</p>
<p>If there is any connection error, it will throw a <strong>PDOException</strong> object that can be caught to handle <strong>Exception</strong> further.</p>
<p><strong>Good read</strong>: <a href="http://php.net/manual/en/pdo.connections.php">Connections and Connection management ¶</a></p>
<p>You can also pass in several driver options as an array to the fourth parameter. I recommend passing the parameter which puts <strong>PDO</strong> into exception mode. Because some <strong>PDO</strong> drivers don&rsquo;t support native prepared statements, so <strong>PDO</strong> performs emulation of the prepare. It also lets you manually enable this emulation. To use the native server-side prepared statements, you should explicitly set it <strong>false</strong>.</p>
<p>The other is to turn off prepare emulation which is enabled in the <strong>MySQL</strong> driver by default, but prepare emulation should be turned off to use <strong>PDO</strong> safely.</p>
<p>I will later explain why prepare emulation should be turned off. To find reason please check <a href="https://stackoverflow.com/a/12202218/1723893">this post</a>.</p>
<p>It is only usable if you are using an old version of <strong>MySQL</strong> which I do not recommended.</p>
<p>Below is an example of how you can do it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$db <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PDO</span>(<span style="color:#e6db74">&#39;mysql:host=localhost;dbname=testdb;charset=UTF-8&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#39;username&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#39;password&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">array</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ATTR_EMULATE_PREPARES</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ATTR_ERRMODE</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ERRMODE_EXCEPTION</span>));
</span></span></code></pre></div><p><strong>Can we set attributes after PDO construction?</strong></p>
<p><strong>Yes</strong>, we can also set some attributes after PDO construction with the <strong>setAttribute</strong> method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$db <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PDO</span>(<span style="color:#e6db74">&#39;mysql:host=localhost;dbname=testdb;charset=UTF-8&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#39;username&#39;</span>,
</span></span><span style="display:flex;"><span>              <span style="color:#e6db74">&#39;password&#39;</span>);
</span></span><span style="display:flex;"><span>$db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAttribute</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ATTR_ERRMODE</span>, <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ERRMODE_EXCEPTION</span>);
</span></span><span style="display:flex;"><span>$db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAttribute</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ATTR_EMULATE_PREPARES</span>, <span style="color:#66d9ef">false</span>);
</span></span></code></pre></div><h3 id="error-handling">Error Handling</h3>
<p>Error handling is much easier in <strong>PDO</strong> than <strong>mysql_</strong>.</p>
<p>A common practice when using <strong>mysql_</strong> is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">//Connected to MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$result <span style="color:#f92672">=</span> <span style="color:#a6e22e">mysql_query</span>(<span style="color:#e6db74">&#34;SELECT * FROM table&#34;</span>, $link) <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">die</span>(<span style="color:#a6e22e">mysql_error</span>($link));
</span></span></code></pre></div><p><strong>OR die()</strong> is not a good way to handle the error since we can not handle the thing in <strong>die</strong>. It will just end the script abruptly and then echo the error to the screen which you usually do NOT want to show to your end users, and let bloody hackers discover your schema. Alternately, the return values of <strong>mysql_</strong> functions can often be used in conjunction with <a href="http://php.net/mysql_error">mysql_error()</a> to handle errors.</p>
<p><strong>PDO</strong> offers a better solution: exceptions. Anything we do with <strong>PDO</strong> should be wrapped in a <strong>try</strong>-<strong>catch</strong> block. We can force <strong>PDO</strong> into one of three error modes by setting the error mode attribute. Three error handling modes are below.</p>
<ul>
<li><strong>PDO::ERRMODE_SILENT</strong>. It&rsquo;s just setting error codes and acts pretty much the same as <strong>mysql_</strong> where you must check each result and then look at <strong>$db-&gt;errorInfo();</strong> to get the error details.</li>
<li><strong>PDO::ERRMODE_WARNING</strong> Raise <strong>E_WARNING</strong>. (Run-time warnings (non-fatal errors). Execution of the script is not halted.)</li>
<li><strong>PDO::ERRMODE_EXCEPTION</strong>: Throw exceptions. It represents an error raised by PDO. You should not throw a <strong>PDOException</strong> from your own code. See <em>Exceptions</em> for more information about exceptions in PHP. It acts very much like <strong>or die(mysql_error());</strong>, when it isn&rsquo;t caught. But unlike <strong>or die()</strong>, the <strong>PDOException</strong> can be caught and handled gracefully if you choose to do so.</li>
</ul>
<p><strong>Good read</strong>:</p>
<ul>
<li><a href="http://php.net/manual/en/pdo.error-handling.php">Errors and error handling ¶</a></li>
<li><a href="http://php.net/manual/en/class.pdoexception.php">The PDOException class ¶</a></li>
<li><a href="http://www.php.net/manual/en/language.exceptions.php">Exceptions ¶</a></li>
</ul>
<p>Like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAttribute</span>( <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ATTR_ERRMODE</span>, <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ERRMODE_SILENT</span> );
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAttribute</span>( <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ATTR_ERRMODE</span>, <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ERRMODE_WARNING</span> );
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAttribute</span>( <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ATTR_ERRMODE</span>, <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ERRMODE_EXCEPTION</span> );
</span></span></code></pre></div><p>And you can wrap it in <strong>try</strong>-<strong>catch</strong>, like below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Connect as appropriate as above
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#39;hi&#39;</span>); <span style="color:#75715e">//Invalid query!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">PDOException</span> $ex) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;An Error occured!&#34;</span>; <span style="color:#75715e">//User friendly message/message you want to show to user
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">some_logging_function</span>($ex<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>You do not have to handle with <strong>try</strong>-<strong>catch</strong> right now. You can catch it at any time appropriate, but I strongly recommend you to use <strong>try</strong>-<strong>catch</strong>. Also it may make more sense to catch it at outside the function that calls the <strong>PDO</strong> stuff:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">data_fun</span>($db) {
</span></span><span style="display:flex;"><span>    $stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#34;SELECT * FROM table&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">fetchAll</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">FETCH_ASSOC</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//Then later
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">data_fun</span>($db);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">PDOException</span> $ex) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Here you can handle error and show message/perform action you want.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>Also, you can handle by <strong>or die()</strong> or we can say like <strong>mysql_</strong>, but it will be really varied. You can hide the dangerous error messages in production by turning <strong>display_errors off</strong> and just reading your error log.</p>
<p>Now, after reading all the things above, you are probably thinking: what the heck is that when I just want to start leaning simple <strong>SELECT</strong>, <strong>INSERT</strong>, <strong>UPDATE</strong>, or <strong>DELETE</strong> statements? Don&rsquo;t worry, here we go:</p>
<h3 id="selecting-data">Selecting Data</h3>
<p>So what you are doing in <strong>mysql_</strong> is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$result <span style="color:#f92672">=</span> <span style="color:#a6e22e">mysql_query</span>(<span style="color:#e6db74">&#39;SELECT * from table&#39;</span>) <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">die</span>(<span style="color:#a6e22e">mysql_error</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$num_rows <span style="color:#f92672">=</span> <span style="color:#a6e22e">mysql_num_rows</span>($result);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span>($row <span style="color:#f92672">=</span> <span style="color:#a6e22e">mysql_fetch_assoc</span>($result)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> $row[<span style="color:#e6db74">&#39;field1&#39;</span>];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now in <strong>PDO</strong>, you can do this like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#39;SELECT * FROM table&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span>($row <span style="color:#f92672">=</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">FETCH_ASSOC</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> $row[<span style="color:#e6db74">&#39;field1&#39;</span>];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Or</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#39;SELECT * FROM table&#39;</span>);
</span></span><span style="display:flex;"><span>$results <span style="color:#f92672">=</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">fetchAll</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">FETCH_ASSOC</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//Use $results
</span></span></span></code></pre></div><p><strong>Note</strong>: If you are using the method like below (<strong>query()</strong>), this method returns a <strong>PDOStatement</strong> object. So if you want to fetch the result, use it like above.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span>($db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#39;SELECT * FROM table&#39;</span>) <span style="color:#66d9ef">as</span> $row) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">echo</span> $row[<span style="color:#e6db74">&#39;field1&#39;</span>];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>In PDO Data, it is obtained via the <strong>-&gt;fetch()</strong>, a method of your statement handle. Before calling fetch, the best approach would be telling PDO how you’d like the data to be fetched. In the below section I am explaining this.</p>
<h3 id="insert-and-update-or-delete-statements">Insert and Update or Delete statements</h3>
<p>What we are doing in <strong>mysql_</strong> function is:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$results <span style="color:#f92672">=</span> <span style="color:#a6e22e">mysql_query</span>(<span style="color:#e6db74">&#34;UPDATE table SET field=&#39;value&#39;&#34;</span>) <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">die</span>(<span style="color:#a6e22e">mysql_error</span>());
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> <span style="color:#a6e22e">mysql_affected_rows</span>($result);
</span></span></code></pre></div><p>And in pdo, this same thing can be done by:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$affected_rows <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">exec</span>(<span style="color:#e6db74">&#34;UPDATE table SET field=&#39;value&#39;&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $affected_rows;
</span></span></code></pre></div><p>In the above query <a href="http://php.net/manual/en/pdo.exec.php"><strong>PDO::exec</strong></a> execute an SQL statement and returns the number of affected rows.</p>
<p><em>Insert and delete will be covered later.</em></p>
<p>The above method is only useful when you are not using variable in query. But when you need to use a variable in a query, do not ever ever try like the above and there for <a href="http://en.wikipedia.org/wiki/Prepared_statement"><strong>prepared statement or parameterized statement</strong></a> is.</p>
<h2 id="others-in-pdo">Others in PDO</h2>
<h3 id="fetch-modes-in-pdo">Fetch Modes in PDO</h3>
<p>Note the use of <strong>PDO::FETCH_ASSOC</strong> in the <strong>fetch()</strong> and <strong>fetchAll()</strong> code above. This tells <strong>PDO</strong> to return the rows as an associative array with the field names as keys. There are many other fetch modes too which I will explain one by one.</p>
<p>First of all, I explain how to select fetch mode:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">FETCH_ASSOC</span>)
</span></span></code></pre></div><p>In the above, I have been using <strong>fetch()</strong>. You can also use:</p>
<ul>
<li><a href="http://php.net/manual/en/pdostatement.fetchall.php"><strong>PDOStatement::fetchAll()</strong></a> - Returns an array containing all of the result set rows</li>
<li><a href="http://php.net/manual/en/pdostatement.fetchcolumn.php"><strong>PDOStatement::fetchColumn()</strong></a> - Returns a single column from the next row of a result set</li>
<li><a href="http://php.net/manual/en/pdostatement.fetchobject.php"><strong>PDOStatement::fetchObject()</strong></a> - Fetches the next row and returns it as an object.</li>
<li><a href="http://php.net/manual/en/pdostatement.setfetchmode.php"><strong>PDOStatement::setFetchMode()</strong></a> - Set the default fetch mode for this statement</li>
</ul>
<p>Now I come to fetch mode:</p>
<ul>
<li><strong>PDO::FETCH_ASSOC</strong>: returns an array indexed by column name as returned in your result set</li>
<li><strong>PDO::FETCH_BOTH</strong> (default): returns an array indexed by both column name and 0-indexed column number as returned in your result set</li>
</ul>
<p>There are even more choices! Read about them all in <a href="http://www.php.net/manual/en/pdostatement.fetch.php"><strong>PDOStatement</strong> Fetch documentation.</a>.</p>
<h3 id="prepared-statements">Prepared Statements</h3>
<p><strong>Q.</strong> What is a prepared statement and why do I need them?
<strong>A.</strong> A prepared statement is a pre-compiled SQL statement that can be executed multiple times by sending only the data to the server.</p>
<p>The typical workflow of using a prepared statement is as follows (<a href="http://en.wikipedia.org/wiki/Prepared_statement">quoted from Wikipedia three 3 point</a>):</p>
<ol>
<li>
<p><strong>Prepare</strong>: The statement template is created by the application and sent to the database management system (DBMS). Certain values are left unspecified, called parameters, placeholders or bind variables (labelled <strong>?</strong> below):</p>
<p><strong>INSERT INTO PRODUCT (name, price) VALUES (?, ?)</strong></p>
</li>
<li>
<p>The DBMS parses, compiles, and performs query optimization on the statement template, and stores the result without executing it.</p>
</li>
<li>
<p><strong>Execute</strong>: At a later time, the application supplies (or binds) values for the parameters, and the DBMS executes the statement (possibly returning a result). The application may execute the statement as many times as it wants with different values. In this example, it might supply &lsquo;Bread&rsquo; for the first parameter and <strong>1.00</strong> for the second parameter.</p>
</li>
</ol>
<p>You can use a prepared statement by including placeholders in your SQL. There are basically three ones without placeholders (don&rsquo;t try this with variable its above one), one with unnamed placeholders, and one with named placeholders.</p>
<p><strong>Q.</strong> So now, what are named placeholders and how do I use them?
<strong>A.</strong> Named placeholders. Use descriptive names preceded by a colon, instead of question marks. We don&rsquo;t care about position/order of value in name place holder:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">bindParam</span>(<span style="color:#e6db74">&#39;:bla&#39;</span>, $bla);
</span></span></code></pre></div><p><a href="http://php.net/manual/en/pdostatement.bindparam.php"><strong>bindParam(parameter,variable,data_type,length,driver_options)</strong></a></p>
<p>You can also bind using an execute array as well:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;SELECT * FROM table WHERE id=:id AND name=:name&#34;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;:name&#39;</span> <span style="color:#f92672">=&gt;</span> $name, <span style="color:#e6db74">&#39;:id&#39;</span> <span style="color:#f92672">=&gt;</span> $id));
</span></span><span style="display:flex;"><span>$rows <span style="color:#f92672">=</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">fetchAll</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">FETCH_ASSOC</span>);
</span></span></code></pre></div><p>Another nice feature for <strong>OOP</strong> friends is that named placeholders have the ability to insert objects directly into your database, assuming the properties match the named fields. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">person</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> $add;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> __construct($a,$b) {
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> $a;
</span></span><span style="display:flex;"><span>        $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">add</span> <span style="color:#f92672">=</span> $b;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>$demo <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">person</span>(<span style="color:#e6db74">&#39;john&#39;</span>,<span style="color:#e6db74">&#39;29 bla district&#39;</span>);
</span></span><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;INSERT INTO table (name, add) value (:name, :add)&#34;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>((<span style="color:#66d9ef">array</span>)$demo);
</span></span></code></pre></div><p><strong>Q.</strong> So now, what are unnamed placeholders and how do I use them?
<strong>A.</strong> Let&rsquo;s have an example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;INSERT INTO folks (name, add) values (?, ?)&#34;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">bindValue</span>(<span style="color:#ae81ff">1</span>, $name, <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">PARAM_STR</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">bindValue</span>(<span style="color:#ae81ff">2</span>, $add, <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">PARAM_STR</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>();
</span></span></code></pre></div><p>and</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;INSERT INTO folks (name, add) values (?, ?)&#34;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;john&#39;</span>, <span style="color:#e6db74">&#39;29 bla district&#39;</span>));
</span></span></code></pre></div><p>In the above, you can see those <strong>?</strong> instead of a name like in a name place holder. Now in the first example, we assign variables to the various placeholders (<strong>$stmt-&gt;bindValue(1, $name, PDO::PARAM_STR);</strong>). Then, we assign values to those placeholders and execute the statement. In the second example, the first array element goes to the first <strong>?</strong> and the second to the second <strong>?</strong>.</p>
<p><strong>NOTE</strong>: In <strong>unnamed placeholders</strong> we must take care of the proper order of the elements in the array that we are passing to the <strong>PDOStatement::execute()</strong> method.</p>
<h4 id="select-insert-update-delete-prepared-queries">SELECT, INSERT, UPDATE, DELETE prepared queries</h4>
<ol>
<li>
<p><strong>SELECT</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;SELECT * FROM table WHERE id=:id AND name=:name&#34;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;:name&#39;</span> <span style="color:#f92672">=&gt;</span> $name, <span style="color:#e6db74">&#39;:id&#39;</span> <span style="color:#f92672">=&gt;</span> $id));
</span></span><span style="display:flex;"><span>$rows <span style="color:#f92672">=</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">fetchAll</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">FETCH_ASSOC</span>);
</span></span></code></pre></div></li>
<li>
<p><strong>INSERT</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;INSERT INTO table(field1,field2) VALUES(:field1,:field2)&#34;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#39;:field1&#39;</span> <span style="color:#f92672">=&gt;</span> $field1, <span style="color:#e6db74">&#39;:field2&#39;</span> <span style="color:#f92672">=&gt;</span> $field2));
</span></span><span style="display:flex;"><span>$affected_rows <span style="color:#f92672">=</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">rowCount</span>();
</span></span></code></pre></div></li>
<li>
<p><strong>DELETE</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;DELETE FROM table WHERE id=:id&#34;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">bindValue</span>(<span style="color:#e6db74">&#39;:id&#39;</span>, $id, <span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">PARAM_STR</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>();
</span></span><span style="display:flex;"><span>$affected_rows <span style="color:#f92672">=</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">rowCount</span>();
</span></span></code></pre></div></li>
<li>
<p><strong>UPDATE</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;UPDATE table SET name=? WHERE id=?&#34;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">array</span>($name, $id));
</span></span><span style="display:flex;"><span>$affected_rows <span style="color:#f92672">=</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">rowCount</span>();
</span></span></code></pre></div></li>
</ol>
<p><strong>NOTE</strong>: If you use the <strong>like</strong> statement, please bind the % in execute statement.</p>
<h3 id="getting-the-row-count">Getting the row count</h3>
<p>Instead of using <strong>mysql_num_rows</strong> to get the number of returned rows, you can get a <strong>PDOStatement</strong> and do <strong>rowCount()</strong>, like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#39;SELECT * FROM table&#39;</span>);
</span></span><span style="display:flex;"><span>$row_count <span style="color:#f92672">=</span> $stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">rowCount</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">echo</span> $row_count<span style="color:#f92672">.</span><span style="color:#e6db74">&#39; rows selected&#39;</span>;
</span></span></code></pre></div><h3 id="getting-the-last-inserted-id">Getting the Last Inserted ID</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$result <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">exec</span>(<span style="color:#e6db74">&#34;INSERT INTO table(firstname, lastname) VAULES(&#39;John&#39;, &#39;Doe&#39;)&#34;</span>);
</span></span><span style="display:flex;"><span>$insertId <span style="color:#f92672">=</span> $db<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">lastInsertId</span>();
</span></span></code></pre></div><h2 id="note">NOTE</h2>
<p>However <strong>PDO</strong> and/or <strong>MySQLi</strong> are not completely safe. Check the answer <em><a href="https://stackoverflow.com/a/12202218/1723893">Are PDO prepared statements sufficient to prevent SQL injection?</a></em> by <a href="https://stackoverflow.com/users/338665/ircmaxell">ircmaxell</a>. Also, I am quoting some part from his answer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$pdo<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setAttribute</span>(<span style="color:#a6e22e">PDO</span><span style="color:#f92672">::</span><span style="color:#a6e22e">ATTR_EMULATE_PREPARES</span>, <span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>$pdo<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">query</span>(<span style="color:#e6db74">&#39;SET NAMES GBK&#39;</span>);
</span></span><span style="display:flex;"><span>$stmt <span style="color:#f92672">=</span> $pdo<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">prepare</span>(<span style="color:#e6db74">&#34;SELECT * FROM test WHERE name = ? LIMIT 1&#34;</span>);
</span></span><span style="display:flex;"><span>$stmt<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">execute</span>(<span style="color:#66d9ef">array</span>(<span style="color:#a6e22e">chr</span>(<span style="color:#ae81ff">0xbf</span>) <span style="color:#f92672">.</span> <span style="color:#a6e22e">chr</span>(<span style="color:#ae81ff">0x27</span>) <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34; OR 1=1 /*&#34;</span>));
</span></span></code></pre></div><h2 id="addition">Addition</h2>
<p>This article is excerpted from <a href="https://stackoverflow.com/questions/12859942/why-shouldnt-i-use-mysql-functions-in-php">why-shouldnt-i-use-mysql-functions-in-php</a> and revised appropriately.</p>
</section>

  
  
  <footer class="mt-12 flex flex-wrap">
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]"
      href="https://aecra.github.io/tags/php"
      >PHP</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]"
      href="https://aecra.github.io/tags/pdo"
      >PDO</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]"
      href="https://aecra.github.io/tags/mysql"
      >MySQL</a
    >
    
  </footer>
  

  
  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a
      class="flex w-1/2 items-center rounded-l-md p-6 pr-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="https://aecra.github.io/en/article/docker-tutorial/"
      ><span class="mr-1.5">←</span><span>Docker tutorial</span></a
    >
    
    
  </nav>
  
  

  
  

  
  

  
  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2023
    <a class="link" href="https://aecra.github.io">Tian Jiale&#39;s Blog</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by Hugo️️</a
  >️
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >✎ Paper</a
  >
</footer>

  </body>
</html>
